# AI Prompt สำหรับระบบฐานข้อมูลลูกค้าตามใบกำกับภาษีไทย

## โครงสร้างฐานข้อมูล (บน Server Clickhouse ทำงานผ่าน API)

คุณกำลังพัฒนาระบบฐานข้อมูลลูกค้าสำหรับออกใบกำกับภาษีตามกฎหมายไทย ที่มีโครงสร้างดังนี้:

### ตาราง customers
- **customer_id**: รหัสลูกค้า (เลขจำนวนเต็ม, auto increment)
- **customer_type**: ประเภทลูกค้า ('individual' = บุคคลธรรมดา, 'company' = นิติบุคคล)
- **tax_id**: เลขประจำตัวผู้เสียภาษี (13 หลัก, ไม่ซ้ำ, บังคับสำหรับนิติบุคคล, ไม่บังคับสำหรับบุคคลธรรมดา)
- **title**: คำนำหน้าชื่อ (นาย/นาง/นางสาว/ดร.)
- **first_name**: ชื่อ (บังคับสำหรับบุคคลธรรมดา)
- **last_name**: นามสกุล (บังคับสำหรับบุคคลธรรมดา)
- **company_name**: ชื่อบริษัท/ห้างร้าน (บังคับสำหรับนิติบุคคล)
- **address_line1**: ที่อยู่หลัก บ้านเลขที่ ซอย ถนน (บังคับ)
- **address_line2**: ที่อยู่เพิ่มเติม
- **subdistrict**: ตำบล/แขวง
- **district**: อำเภอ/เขต (บังคับ)
- **province**: จังหวัด (บังคับ)
- **postal_code**: รหัสไปรษณีย์ 5 หลัก (บังคับ)
- **phone**: เบอร์โทรศัพท์ (ไม่บังคับ)
- **email**: อีเมล (ไม่บังคับ)
- **status**: สถานะ ('active'/'inactive')
- **is_line_connected**: สถานะการเชื่อมต่อ LINE OA (boolean)
- **line_user_id**: LINE User ID
- **line_display_name**: ชื่อที่แสดงใน LINE
- **line_connected_at**: วันที่เชื่อมต่อ LINE OA
- **is_verified**: สถานะการยืนยันตัวตน (boolean)
- **verified_at**: วันที่ยืนยันตัวตน
- **notes**: บันทึกเพิ่มเติม

## ฟีเจอร์ที่ต้องการ

### 1. ค้นหาข้อมูลบริษัทจากเลขประจำตัวผู้เสียภาษี
เมื่อผู้ใช้ป้อน **tax_id** (เลข 13 หลัก):
- ให้ค้นหาข้อมูลบริษัทจากแหล่งข้อมูลภาครัฐไทยบนอินเทอร์เน็ต
- ดึงข้อมูลที่ได้: ชื่อบริษัทเต็ม, ที่อยู่ที่จดทะเบียน, สถานะธุรกิจ
- เติมข้อมูลที่ได้ลงในฟิลด์ที่เกี่ยวข้องโดยอัตโนมัติ
- แหล่งข้อมูลที่เป็นไปได้: เว็บไซต์กรมพัฒนาธุรกิจการค้า, ฐานข้อมูล VAT Registration

### 2. ค้นหาข้อมูลที่อยู่จากรหัสไปรษณีย์
เมื่อผู้ใช้ป้อน **postal_code** (เลข 5 หลัก):
- ค้นหาข้อมูลพื้นที่จากฐานข้อมูลรหัสไปรษณีย์ไทยบนอินเทอร์เน็ต
- เติมข้อมูลเริ่มต้น (default values) ให้กับ:
  - **province**: จังหวัด
  - **district**: อำเภอ/เขต
  - **subdistrict**: ตำบล/แขวง
- แหล่งข้อมูลที่เป็นไปได้: เว็บไซต์ไปรษณีย์ไทย, API ของรัฐบาล

### 3. ระบบเลือกที่อยู่แบบลำดับขั้น (Cascading Address Selection)

#### ขั้นตอนที่ 1: เลือกจังหวัด
- ค้นหารายชื่อจังหวัดทั้งหมดในประเทศไทยจากอินเทอร์เน็ต
- แสดงรายการให้ผู้ใช้เลือก (77 จังหวัด)
- เรียงลำดับตามตัวอักษร

#### ขั้นตอนที่ 2: เลือกอำเภอ
- เมื่อเลือกจังหวัดแล้ว ให้ค้นหารายชื่ออำเภอในจังหวัดนั้นๆ
- แสดงเฉพาะอำเภอที่อยู่ในจังหวัดที่เลือก
- เรียงลำดับตามตัวอักษร

#### ขั้นตอนที่ 3: เลือกตำบล
- เมื่อเลือกอำเภอแล้ว ให้ค้นหารายชื่อตำบลในอำเภอนั้นๆ
- แสดงเฉพาะตำบลที่อยู่ในอำเภอที่เลือก
- เรียงลำดับตามตัวอักษร

#### ขั้นตอนที่ 4: อัปเดตรหัสไปรษณีย์
- เมื่อเลือกตำบลแล้ว ให้ค้นหาและเติมรหัสไปรษณีย์ที่ตรงกัน

## แหล่งข้อมูลที่แนะนำ

### สำหรับข้อมูลบริษัท:
- เว็บไซต์กรมพัฒนาธุรกิจการค้า (dbd.go.th)
- ระบบค้นหาบริษัทของกรมสรรพากร
- API ของหน่วยงานราชการที่เปิดให้ใช้

### สำหรับข้อมูลที่อยู่:
- เว็บไซต์บริษัทไปรษณีย์ไทย
- ฐานข้อมูลที่อยู่ของกรมการปกครอง
- API Geographic Information ของรัฐบาล

## กฎการทำงาน

1. **การตรวจสอบ**: ตรวจสอบรูปแบบข้อมูลก่อนค้นหา (tax_id ต้อง 13 หลัก, postal_code ต้อง 5 หลัก)

2. **การจัดการข้อผิดพลาด**: หากไม่พบข้อมูลจากการค้นหา ให้แจ้งผู้ใช้และให้ป้อนข้อมูลเอง

3. **การยืนยัน**: ให้ผู้ใช้ยืนยันข้อมูลที่ระบบเติมให้โดยอัตโนมัติ

4. **การบันทึก**: บันทึกข้อมูลเฉพาะเมื่อผู้ใช้ยืนยันแล้ว

## ผลลัพธ์ที่คาดหวัง

ระบบที่สามารถ:
- ลดเวลาการป้อนข้อมูลของผู้ใช้
- เพิ่มความถูกต้องของข้อมูลที่อยู่และข้อมูลบริษัท
- ให้ประสบการณ์การใช้งานที่สะดวกและรวดเร็ว
- รองรับข้อมูลตามมาตรฐานของใบกำกับภาษีไทย

หน้าจอนี้ ใช้ชื่อ cutomer_form.dart และอยู่ในโฟลเดอร์ lib/pages/customers/
- ลูกค้าทั่วไป เมื่อ Login แล้ว สามารถเข้ามาแก้ไขข้อมูลส่วนตัวได้
- พนักงาน เมื่อ Login แล้ว สามารถเข้ามาแก้ไขข้อมูลส่วนลูกค้าได้ (เพิ่มได้ แก้ไขได้ ลบไม่ได้)
- ผู้ดูแลระบบ เมื่อ Login แล้ว สามารถเข้ามาแก้ไขข้อมูลส่วนลูกค้าได้ (เพิ่มได้ แก้ไขได้ ลบไม่ได้)

ใช้ email เป็นรหัสผู้ใช้ในทุกระบบ ไม่ว่าจะเป็น การสั่งสินค้า ตระกร้า เอกสารลูกค้า ทั้งหมด ทุกอย่างใช้ email เป็นหลักในการเชื่อมโยงข้อมูล

รหัสลูกค้า เอาไว้เชื่อมกับระบบอื่นๆ

ไม่ตรวจสอบเลขที่ผู้เสียบภาษี ตอนกดบันทึกข้อมูลลูกค้า
- แต่ถ้าเป็นนิติบุคคล จะต้องมีเลขที่ผู้เสียภาษี 13 หลัก
- ถ้าเป็นบุคคลธรรมดา จะต้องมีเลขที่ผู้เสียภาษี 13 หลัก หรือไม่ก็ไม่ต้องกรอก
- ถ้าเป็นนิติบุคคล จะต้องมีชื่อบริษัท
- ถ้าเป็นบุคคลธรรมดา จะต้องมีชื่อจริง และนามสกุล
- ถ้าเป็นนิติบุคคล จะต้องมีที่อยู่
- ถ้าเป็นบุคคลธรรมดา จะต้องมีที่อยู่
- ถ้าเป็นนิติบุคคล จะต้องมีเบอร์โทรศัพท์
- ถ้าเป็นบุคคลธรรมดา จะต้องมีเบอร์โทรศัพท์
- Email ไม่บังคับ
- หมายเลขโทรศัพท์ ไม่บังคับ
- LINE OA integration fields (is_line_connected, line_user_id, line_display_name, is_verified, notes) เป็นข้อมูลเสริมสำหรับการจัดการลูกค้า